## Stuff related to Docker

# VirtualBox DHCP may change the IP. Use redock to
# update the DOCKER_HOST var
redock() {
  export DOCKER_IP=$(boot2docker ip 2>/dev/null)
  export DOCKER_HOST="tcp://$DOCKER_IP:2375"
}

dock() {
  redock

  if [ "$1" == "elasticsearch" ]; then
    docker stop elasticsearch &> /dev/null
    docker rm elasticsearch &> /dev/null
    docker run --detach \
               --publish 9200:9200 \
               --publish 9300:9300 \
               --name elasticsearch \
               dockerfile/elasticsearch
    echo "Elasticsearch started. Listening to $DOCKER_IP:9200"
  elif [ "$1" == "mongodb" ]; then
    docker run --detach \
               --publish 27017:27017 \
               --name mongodb \
               dockerfile/mongodb
    echo "MongoDB started. Listening to $DOCKER_IP:27017"
  else
    echo "Unknown service. Sample usage: 'dock elasticsearch'"
  fi
}
